#!/bin/bash

root_dir="$(dirname "$0")"
assets_dir=assets
fonts_dir=$assets_dir/fonts
prefix=/usr
ext=
sdl_libs=
if [ `uname -s` == "Darwin" ]; then
    echo "Configured for Darwin"
    ext=dylib
    sdl_libs="-lsdl2 -lsdl2_image -lsdl2_ttf"
elif [ `uname -s` == "Linux" ]; then
    echo "Configured for Linux"
    ext=so
    sdl_libs="-lSDL2 -lSDL2_image -lSDL2_ttf"
else
    echo "Unsupported platform"
    exit 112
fi

# Import Generate items generated by conan
echo "Checking Conanfile"
if [ ! -e "./conanbuildinfo.mak" ]; then
    echo "Missing conanbuildinfo.mak. Did you forget to run `conan install ./.conanfile`?"
fi


echo "# Examples file generated by configure script" > make.examples
echo "" >> make.examples
# Find all examples
examples_list=
clean_list=
mrproper_list=
example_rules=
for file in `ls examples`; do
    if [ -d "examples/$file" -a -f "examples/$file/Makefile" ]; then
        examples_list="$examples_list $file"
        clean_list="$clean_list $file-clean"
        mrproper_list="$mrproper_list $file-mrproper"
        echo "$file:" >> make.examples
        echo -e "\t\$(MAKE) -C ./examples/$file $file" >> make.examples
        # Putting clean target
        echo "" >> make.examples
        echo "$file-clean:" >> make.examples
        echo -e "\t\$(MAKE) -C ./examples/$file clean" >> make.examples
        # Putting mrproper target
        echo "" >> make.examples
        echo "$file-mrproper:" >> make.examples
        echo -e "\t\$(MAKE) -C ./examples/$file mrproper" >> make.examples
    fi
done

echo "" >> make.examples
echo "examples:$examples_list" >> make.examples
echo "" >> make.examples
echo "examples-clean:$clean_list" >> make.examples
echo "" >> make.examples
echo "examples-mrproper:$mrproper_list" >> make.examples

echo $example_rules

output_file=make.config

echo "# ${output_file} generate by configure script" > $output_file
echo "EXAMPLES =$examples_list" >> $output_file
echo "EXT=${ext}" >> $output_file
echo "SDL_LIBS=${sdl_libs}" >> $output_file
echo "PREFIX=${prefix}" >> $output_file

echo "export EXAMPLES" >> $output_file
echo "export EXT" >> $output_file
echo "export SDL_LIBS" >> $output_file
echo "export PREFIX" >> $output_file
